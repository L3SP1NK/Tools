#!/bin/bash

get_max_freq() {
    local max_freq=0
    for core in $(seq 0 $(( $(nproc) - 1 )) ); do
        freq=$(cat /sys/devices/system/cpu/cpu$core/cpufreq/scaling_max_freq 2>/dev/null || echo 0)
        if (( freq > max_freq )); then
            max_freq=$freq
        fi
    done
    echo $max_freq


}

max_freq=$(get_max_freq)
max_freq_ghz=$(echo "scale=2; $max_freq / 1000000" | bc)

get_color_and_emoji() {
    local ratio=$1
    case 1 in
        $(echo "$ratio > 1.1" | bc -l))
            echo -e "\e[35m󱀚"
            ;;
        $(echo "$ratio >= 0.9" | bc -l))
            echo -e "\e[31m"
            ;;
        $(echo "$ratio >= 0.75" | bc -l))
            echo -e "\e[33m"
            ;;
        $(echo "$ratio >= 0.5" | bc -l))
            echo -e "\e[32m"
            ;;
        $(echo "$ratio >= 0.25" | bc -l))
            echo -e "\e[32m"
            ;;
        *)
            echo -e "\e[38m󰂃"
            ;;
    esac
}

echo -e " \e[1m\e[4mCPU Frequency:\e[0m\n"

# Iterate over each CPU
for core in $(seq 0 $(( $(nproc) - 1 )) ); do
    freq=$(cat /sys/devices/system/cpu/cpu$core/cpufreq/scaling_cur_freq 2>/dev/null || echo 0)
    freq_ghz=$(echo "scale=2; $freq / 1000000" | bc)
    ratio=$(echo "scale=2; $freq / $max_freq" | bc)
    color_and_emoji=$(get_color_and_emoji $ratio)

	[[ "${ratio:0:1}" == '.' ]] && ratio="0${ratio}"

	echo -e "${color_and_emoji} CPU $core: $freq_ghz GHz ($ratio)\033[0m"
done
